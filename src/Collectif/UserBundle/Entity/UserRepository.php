<?php

namespace Collectif\UserBundle\Entity;

use Doctrine\ORM\EntityRepository;

/**
 * UserRepository
 *
 * This class was generated by the Doctrine ORM. Add your own custom
 * repository methods below.
 */
class UserRepository extends EntityRepository
{
	public function getAll()
	{
		$qb = $this->createQueryBuilder('u');

		$qb->orderBy('u.nom', 'ASC');

		return $qb->getQuery()->getResult();
	}
	
	public function getActifEnabled($enabled)
	{
		$parameters = array(
			'enabled' => $enabled
		);
		
		$qb = $this->createQueryBuilder('u');
		$qb->where('u.enabled = :enabled AND u.webmaster = 0')->setParameters($parameters);
		$qb->orderBy('u.nom', 'ASC');
	
		return $qb->getQuery()->getResult();
	}
	
	public function getDisabledUsersSize()
	{
		$parameters = array(
			'enabled' => false
		);
	
		$qb = $this->createQueryBuilder('u');
		$qb->where('u.enabled = :enabled')->setParameters($parameters);
		$qb->orderBy('u.nom', 'ASC');
	
		return $qb->getQuery()->getResult();
	}
	
	/**
	 * Permet de récupérer le nombre d'utilisateurs
	 */
	public function getNbUsers()
	{
	
		$query = $this->createQueryBuilder('u')
			->select('COUNT(u)');
	
		return $query->getQuery()->getSingleScalarResult();
	}
	
	
	public function getUsersBureau()
	{	
		$parameters = array(
			'membreBureau' => true
		);
		
		$qb = $this->createQueryBuilder('u');
		$qb->where('u.membreBureau = :membreBureau')->setParameters($parameters);
		$qb->orderBy('u.ordreBureau', 'ASC');
	
		return $qb->getQuery()->getResult();
	}
	
	public function findByAlias($alias)
	{
		$qb = $this->createQueryBuilder('u');
	
		$qb->where('u.alias = :alias')
		->setParameter('alias', $alias);
	
		return $qb->getQuery()->getSingleResult();
	}
}
